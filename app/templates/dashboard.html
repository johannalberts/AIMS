{% extends "base.html" %}

{% block title %}Dashboard - AIMS{% endblock %}

{% block content %}
<div class="container">
    <div class="dashboard-header">
        <p class="text-gray-600 dark:text-gray-400">Your Mastery Journey Awaits</p>
    </div>
    
    <!-- Active Sessions -->
    <section class="section" x-data="{ showActive: true }">
        <div class="section-header">
            <h2 class="text-gray-900 dark:text-gray-100">ğŸ“š My Active Assessments</h2>
            <button @click="showActive = !showActive" class="btn btn-small bg-indigo-600 dark:bg-indigo-500 hover:bg-indigo-700 dark:hover:bg-indigo-600 text-white">
                <span x-text="showActive ? 'Hide' : 'Show'"></span>
            </button>
        </div>
        
        <div x-show="showActive" class="sessions-grid">
            {% if sessions %}
                {% for session in sessions %}
                    {% if session.status == "in_progress" %}
                    <div class="session-card bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700" id="session-{{ session.session_id }}">
                        <h3 class="text-gray-900 dark:text-gray-100">{{ session.lesson.title }}</h3>
                        <p class="session-status text-yellow-600 dark:text-yellow-400">In Progress</p>
                        <p class="session-date text-gray-600 dark:text-gray-400">Started: {{ session.started_at.strftime('%Y-%m-%d %H:%M') }}</p>
                        <div class="flex gap-2">
                            <a href="/assess/{{ session.session_id }}" class="btn btn-primary bg-indigo-600 dark:bg-indigo-500 hover:bg-indigo-700 dark:hover:bg-indigo-600 text-white">Continue</a>
                            <button 
                                hx-delete="/api/assessment/{{ session.session_id }}"
                                hx-confirm="Are you sure you want to delete this assessment? All progress will be lost."
                                hx-target="#session-{{ session.session_id }}"
                                hx-swap="outerHTML"
                                class="btn btn-small bg-red-600 dark:bg-red-500 hover:bg-red-700 dark:hover:bg-red-600 text-white"
                            >
                                ğŸ—‘ï¸ Delete
                            </button>
                        </div>
                    </div>
                    {% endif %}
                {% endfor %}
            {% else %}
                <p class="empty-state bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-400">No active assessments. Start one below!</p>
            {% endif %}
        </div>
    </section>
    
    <!-- Available Courses -->
    <section class="section">
        <h2 class="text-gray-900 dark:text-gray-100">ğŸ¯ Available Courses</h2>
        <div class="courses-grid">
            {% for course in courses %}
            <div class="course-card bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700">
                <div class="course-header">
                    <h3 class="text-gray-900 dark:text-gray-100">{{ course.title }}</h3>
                    {% if course.difficulty_level %}
                    <span class="badge badge-{{ course.difficulty_level }}">{{ course.difficulty_level }}</span>
                    {% endif %}
                </div>
                <p class="course-subject text-indigo-600 dark:text-indigo-400">{{ course.subject }}</p>
                <p class="course-description text-gray-600 dark:text-gray-400">{{ course.description }}</p>
                <a href="/course/{{ course.id }}" class="btn btn-secondary bg-purple-600 dark:bg-purple-500 hover:bg-purple-700 dark:hover:bg-purple-600 text-white">View Lessons</a>
            </div>
            {% endfor %}
        </div>
    </section>
    
    <!-- Completed Sessions -->
    <section class="section" x-data="{ showCompleted: false }">
        <div class="section-header">
            <h2 class="text-gray-900 dark:text-gray-100">âœ… Completed Assessments</h2>
            <button @click="showCompleted = !showCompleted" class="btn btn-small bg-indigo-600 dark:bg-indigo-500 hover:bg-indigo-700 dark:hover:bg-indigo-600 text-white">
                <span x-text="showCompleted ? 'Hide' : 'Show'"></span>
            </button>
        </div>
        
        <div x-show="showCompleted" class="sessions-grid">
            {% set completed = sessions | selectattr('status', 'equalto', 'completed') | list %}
            {% if completed %}
                {% for session in completed %}
                <div class="session-card completed bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700">
                    <h3 class="text-gray-900 dark:text-gray-100">{{ session.lesson.title }}</h3>
                    <p class="session-status text-green-600 dark:text-green-400">âœ… Completed</p>
                    <p class="session-date text-gray-600 dark:text-gray-400">Completed: {{ session.completed_at.strftime('%Y-%m-%d %H:%M') }}</p>
                    <a href="/assess/{{ session.session_id }}" class="btn btn-secondary bg-purple-600 dark:bg-purple-500 hover:bg-purple-700 dark:hover:bg-purple-600 text-white">View Results</a>
                </div>
                {% endfor %}
            {% else %}
                <p class="empty-state bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-400">No completed assessments yet.</p>
            {% endif %}
        </div>
    </section>
</div>
{% endblock %}
